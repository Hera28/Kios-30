<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kios Bersama</title>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<style>
:root{
  --bg:#f0f3f7; --card:#ffffff; --border:#e5e7eb;
  --text:#2e3137; --muted:#6d7588; --green:#00aa5b;
}
body{margin:0;font-family:system-ui, -apple-system, sans-serif;background:var(--bg);color:var(--text)}

/* HEADER ALA TOKPED */
header{
  background:var(--card); padding:12px 20px; display:flex; align-items:center; gap:20px;
  position:sticky; top:0; z-index:100; box-shadow:0 1px 6px rgba(0,0,0,0.1);
}
.logo{color:var(--green); font-weight:800; font-size:22px; cursor:pointer; white-space:nowrap}
.search-wrapper{flex:1; position:relative}
.search-wrapper input{
  width:100%; padding:10px 15px; border-radius:8px; border:1px solid var(--border);
  background:#f3f4f6; outline:none; box-sizing:border-box;
}

.container{max-width:1150px; margin:20px auto; padding:0 20px; display:flex; gap:20px; flex-wrap:wrap}

/* TABS */
.tabs{display:flex; gap:10px; margin-bottom:16px}
.tabs button{
  padding:8px 16px; border-radius:20px; border:1px solid var(--border);
  background:var(--card); cursor:pointer; font-weight:600; color:var(--muted);
}
.tabs button.active{background:#e8faf1; color:var(--green); border-color:var(--green)}

/* MAIN AREA */
.main-content{flex:3; min-width:300px}
.card{background:var(--card); border:1px solid var(--border); border-radius:12px; padding:16px; margin-bottom:16px; box-shadow:0 1px 4px rgba(0,0,0,0.05)}

/* GRID PRODUK */
.grid-produk{display:grid; grid-template-columns:repeat(auto-fill, minmax(170px, 1fr)); gap:15px}
.item-produk{
  background:var(--card); border:1px solid var(--border); border-radius:10px; 
  overflow:hidden; transition:0.2s; display:flex; flex-direction:column; padding:12px;
}
.item-produk:hover{transform:translateY(-3px); box-shadow:0 4px 10px rgba(0,0,0,0.1)}
.img-box{width:100%; aspect-ratio:1/1; background:#f3f4f6; border-radius:8px; margin-bottom:10px; display:flex; align-items:center; justify-content:center; color:#ccc; font-size:30px}
.item-produk b{font-size:14px; height:38px; overflow:hidden; display:block; margin-bottom:4px}
.item-produk .price{color:var(--text); font-weight:800; font-size:16px}
.item-produk .stok-tag{font-size:12px; color:var(--muted); margin:5px 0}

/* SIDEBAR KERANJANG */
.sidebar{flex:1; min-width:280px}
.cart-sticky{position:sticky; top:90px}

button{padding:10px; border:none; border-radius:10px; background:var(--green); color:white; cursor:pointer; font-weight:600; width:100%}
button.danger{background:#ef4444}
button.gray{background:#334155}
input,select,textarea{width:100%; padding:10px; border-radius:8px; border:1px solid var(--border); margin-bottom:10px; box-sizing:border-box}

.item-list{border-bottom:1px solid #f1f1f1; padding:10px 0; display:flex; justify-content:space-between; align-items:center}
.hidden{display:none}

@media (max-width: 600px) { .sidebar{width:100%} .main-content{width:100%} }
</style>
</head>

<body>

<header>
  <div class="logo" onclick="location.reload()">üß∫ Kios Bersama</div>
  <div class="search-wrapper">
    <input type="text" id="searchInput" placeholder="Cari barang di kios..." onkeyup="filterBarang()">
  </div>
</header>

<div class="container">
  
  <div class="main-content">
    <div class="tabs">
      <button id="tabBuyer" class="active">üõí Pembeli</button>
      <button id="tabAdmin">üîê Admin</button>
    </div>

    <div id="buyer">
      <div class="grid-produk" id="buyerList"></div>
    </div>

    <div id="admin" class="hidden">
      <div class="card">
        <h3>ü§ñ Asisten Stok</h3>
        <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; margin-bottom:10px">
          <button class="gray" onclick="asisten('daftar')">üì¶ Daftar</button>
          <button class="danger" onclick="asisten('menipis')">‚ö†Ô∏è Menipis</button>
          <button style="background:#0ea5e9" onclick="asisten('total')">üìä Total</button>
        </div>
        <textarea id="aiInput" placeholder="contoh: stok gula berapa?"></textarea>
        <button onclick="asisten('tanya')">Tanya</button>
        <div id="aiOutput" style="font-size:13px; margin-top:10px; padding:10px; background:#f9fafb; border-radius:8px; display:none"></div>
      </div>

      <div class="card">
        <h3>Tambah Barang</h3>
        <input id="nama" placeholder="Nama">
        <input id="harga" type="number" placeholder="Harga">
        <input id="stok" type="number" placeholder="Stok">
        <select id="satuan">
          <option value="">Satuan</option>
          <option>Kilogram</option><option>Ons</option><option>Gram</option><option>Liter</option>
          <option>Mililiter</option><option>Botol</option><option>Sachet</option><option>Bungkus</option>
          <option>Pack</option><option>Kardus</option><option>Renceng</option><option>Rak</option>
          <option>Karung</option><option>Butir</option><option>Potong</option>
        </select>
        <button onclick="simpan()">Simpan Barang</button>
      </div>

      <div class="card">
        <h3>Data Barang</h3>
        <div id="adminList"></div>
      </div>
    </div>
  </div>

  <div class="sidebar">
    <div class="card cart-sticky">
      <h3 style="margin-top:0">Keranjang Belanja</h3>
      <div id="cart" style="font-size:13px; color:var(--muted); min-height:40px"></div>
      <div style="margin:15px 0; border-top:1px solid #eee; padding-top:10px">
        <b>Total: Rp <span id="total">0</span></b>
      </div>
      <button onclick="checkout()">Checkout WA</button>
      <button class="gray" style="margin-top:8px; font-size:12px; background:none; color:var(--muted)" onclick="resetCart()">Reset Keranjang</button>
    </div>
  </div>

</div>

<script>
/* ===== CONFIG & DATABASE (IDENTIK KODE ASLI) ===== */
const ADMIN_PW = "kios123";
let adminUnlocked = false;

firebase.initializeApp({
  apiKey: "AIzaSyBCpRbMAIyfJzpzi5iC4xljFt_gyXaJ5Yw",
  authDomain: "kios-30.firebaseapp.com",
  projectId: "kios-30"
});
const db = firebase.firestore();

let BARANG = [];
let CART = {};
const WA = "62811897005";

/* ===== DOM ===== */
const buyerSection = document.getElementById("buyer");
const adminSection = document.getElementById("admin");
const buyerList = document.getElementById("buyerList");
const adminList = document.getElementById("adminList");
const cartEl = document.getElementById("cart");
const totalEl = document.getElementById("total");

const nama = document.getElementById("nama");
const harga = document.getElementById("harga");
const stok = document.getElementById("stok");
const satuan = document.getElementById("satuan");
const aiInput = document.getElementById("aiInput");
const aiOutput = document.getElementById("aiOutput");

/* ===== FIRESTORE (ON SNAPSHOT TETAP ADA) ===== */
db.collection("barang").onSnapshot(snap=>{
  BARANG=[];
  snap.forEach(doc=>{
    const d=doc.data();
    if(!d?.nama||d.harga==null||d.stok==null||!d.satuan) return;
    BARANG.push({id:doc.id,...d});
  });
  renderBuyer();
  renderAdmin();
});

/* ===== CRUD ===== */
function simpan(){
  if(!nama.value||!harga.value||!stok.value||!satuan.value) return alert("Lengkapi data");
  db.collection("barang").add({
    nama:nama.value, harga:+harga.value, stok:+stok.value, satuan:satuan.value
  });
  nama.value=harga.value=stok.value="";
}

function hapus(id){
  if(confirm("Hapus barang?")) db.collection("barang").doc(id).delete();
}

/* ===== RENDER (DENGAN SEARCH & GRID) ===== */
function renderBuyer(filter = ""){
  buyerList.innerHTML="";
  const filteredData = BARANG.filter(b => b.nama.toLowerCase().includes(filter.toLowerCase()));
  
  filteredData.forEach(b=>{
    buyerList.innerHTML+=`
      <div class="item-produk">
        <div class="img-box">üì¶</div>
        <b>${b.nama}</b>
        <div class="price">Rp ${b.harga.toLocaleString()}</div>
        <div class="stok-tag">Stok: ${b.stok} ${b.satuan}</div>
        <button style="padding:6px; font-size:12px" onclick="addCart('${b.id}')">+ Keranjang</button>
      </div>`;
  });
}

function filterBarang(){
  renderBuyer(document.getElementById("searchInput").value);
}

function renderAdmin(){
  adminList.innerHTML="";
  BARANG.forEach(b=>{
    adminList.innerHTML+=`
      <div class="item-list">
        <div><b>${b.nama}</b><br><small>${b.stok} ${b.satuan}</small></div>
        <button class="danger" style="width:auto; padding:5px 10px" onclick="hapus('${b.id}')">Hapus</button>
      </div>`;
  });
}

/* ===== CART LOGIC (IDENTIK KODE ASLI) ===== */
function addCart(id){
  const b = BARANG.find(x => x.id === id);
  if((CART[id] || 0) + 1 > b.stok) return alert("Stok tidak mencukupi");
  CART[id]=(CART[id]||0)+1;
  renderCart();
}

function resetCart(){
  if(!confirm("Reset seluruh keranjang?")) return;
  CART={}; renderCart();
}

function renderCart(){
  cartEl.innerHTML="";
  let total=0;
  for(let id in CART){
    const b=BARANG.find(x=>x.id===id);
    if(!b) continue;
    total+=b.harga*CART[id];
    cartEl.innerHTML+=`<div>${b.nama} x ${CART[id]}</div>`;
  }
  totalEl.innerText=total.toLocaleString();
}

function checkout(){
  if(Object.keys(CART).length===0) return alert("Keranjang masih kosong");
  let msg="Halo, saya mau pesan:%0A";
  let total=0;
  for(let id in CART){
    const b=BARANG.find(x=>x.id===id);
    if(!b) continue;
    msg+=`‚Ä¢ ${b.nama} x ${CART[id]}%0A`;
    total+=b.harga*CART[id];
  }
  msg+=`Total: Rp ${total.toLocaleString()}`;
  window.open(`https://wa.me/${WA}?text=${msg}`);
}

/* ===== ASISTEN (IDENTIK KODE ASLI) ===== */
function asisten(mode){
  aiOutput.style.display="block";
  if(BARANG.length===0){ aiOutput.innerText="ü§ñ Data kosong"; return; }
  if(mode==="daftar") aiOutput.innerHTML=BARANG.map(b=>`‚Ä¢ ${b.nama} (${b.stok} ${b.satuan})`).join("<br>");
  if(mode==="menipis"){
    const low=BARANG.filter(b=>b.stok<=5);
    aiOutput.innerHTML=low.length ? low.map(b=>`‚ö†Ô∏è ${b.nama}: ${b.stok}`).join("<br>") : "‚úÖ Semua stok aman";
  }
  if(mode==="total") aiOutput.innerText=`üìä Total jenis barang: ${BARANG.length}`;
  if(mode==="tanya"){
    const q=aiInput.value.toLowerCase();
    const b=BARANG.find(x=>q.includes(x.nama.toLowerCase()));
    aiOutput.innerText=b ? `ü§ñ Stok ${b.nama}: ${b.stok} ${b.satuan}` : "ü§ñ Barang tidak ditemukan";
  }
}

/* ===== TABS ===== */
tabBuyer.onclick=()=>{
  buyerSection.classList.remove("hidden"); adminSection.classList.add("hidden");
  tabBuyer.classList.add("active"); tabAdmin.classList.remove("active");
};
tabAdmin.onclick=()=>{
  if(!adminUnlocked){
    const pw=prompt("Password admin:");
    if(pw!==ADMIN_PW) return alert("Password salah");
    adminUnlocked=true;
  }
  adminSection.classList.remove("hidden"); buyerSection.classList.add("hidden");
  tabAdmin.classList.add("active"); tabBuyer.classList.remove("active");
};
</script>
</body>
</html>
