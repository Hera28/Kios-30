<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kios 30</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<style>
* { box-sizing: border-box; }
body {
    margin: 0;
    font-family: Inter, system-ui, sans-serif;
    background: #f5f6f7;
    color: #222;
}

/* HEADER */
header {
    background: #fff;
    border-bottom: 1px solid #e5e7eb;
    padding: 12px 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    position: sticky;
    top: 0;
    z-index: 10;
}

.logo {
    background: #16a34a;
    color: white;
    font-weight: 900;
    padding: 8px 12px;
    border-radius: 10px;
}

.search {
    flex: 1;
}

.search input {
    width: 100%;
    padding: 10px 14px;
    border-radius: 10px;
    border: 1px solid #ddd;
}

.admin-btn {
    background: #16a34a;
    color: white;
    border: none;
    padding: 10px 14px;
    border-radius: 10px;
    cursor: pointer;
}

/* LAYOUT */
main {
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: 20px;
    padding: 20px;
}

/* PRODUK */
.products {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 16px;
}

.card {
    background: white;
    border-radius: 14px;
    padding: 14px;
    border: 1px solid #e5e7eb;
}

.card h4 {
    margin: 0 0 6px;
}

.card small {
    color: #6b7280;
}

.card button {
    margin-top: 10px;
    width: 100%;
    padding: 8px;
    background: #16a34a;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}

/* KERANJANG */
.cart {
    background: white;
    border-radius: 16px;
    padding: 16px;
    border: 1px solid #e5e7eb;
    height: fit-content;
}

.cart h3 {
    margin-top: 0;
}

.cart-item {
    font-size: 14px;
    margin-bottom: 6px;
}

.cart-total {
    font-weight: 800;
    margin-top: 10px;
}

.cart button {
    width: 100%;
    margin-top: 8px;
    padding: 10px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
}

.checkout {
    background: #16a34a;
    color: white;
}

.reset {
    background: #ef4444;
    color: white;
}
</style>
</head>

<body>

<header>
    <div class="logo">KB</div>
    <div class="search">
        <input type="text" id="search" placeholder="Cari produk..." onkeyup="filterProduk()">
    </div>
    <button class="admin-btn" onclick="adminLogin()">Admin</button>
</header>

<main>
    <div class="products" id="produkList"></div>

    <div class="cart">
        <h3>Keranjang</h3>
        <div id="cartItems"></div>
        <div class="cart-total" id="cartTotal">Total: Rp 0</div>
        <button class="checkout" onclick="checkout()">Checkout</button>
        <button class="reset" onclick="resetCart()">Reset</button>
    </div>
</main>

<script>
/* FIREBASE â€“ PROJECT KIOS 30 */
firebase.initializeApp({
    apiKey: "AIzaSyBCpRbMAIyfJzpzi5iC4xljFt_gyXaJ5Yw",
    authDomain: "kios-30.firebaseapp.com",
    projectId: "kios-30"
});

const db = firebase.firestore();

let semuaProduk = [];
let cart = {};

/* LOAD PRODUK */
db.collection("barang").onSnapshot(snap => {
    semuaProduk = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    renderProduk(semuaProduk);
});

/* RENDER */
function renderProduk(data) {
    const list = document.getElementById("produkList");
    list.innerHTML = "";
    data.forEach(p => {
        list.innerHTML += `
        <div class="card">
            <h4>${p.nama}</h4>
            <small>${p.satuan}</small>
            <div><b>Rp ${p.harga.toLocaleString()}</b></div>
            <button onclick="addCart('${p.id}')">Tambah</button>
        </div>`;
    });
}

/* SEARCH */
function filterProduk() {
    const q = document.getElementById("search").value.toLowerCase();
    renderProduk(semuaProduk.filter(p => p.nama.toLowerCase().includes(q)));
}

/* CART */
function addCart(id) {
    cart[id] = (cart[id] || 0) + 1;
    renderCart();
}

function renderCart() {
    const el = document.getElementById("cartItems");
    const totalEl = document.getElementById("cartTotal");
    let total = 0;
    el.innerHTML = "";

    for (let id in cart) {
        const p = semuaProduk.find(x => x.id === id);
        const sub = p.harga * cart[id];
        total += sub;
        el.innerHTML += `<div class="cart-item">${p.nama} x${cart[id]}</div>`;
    }
    totalEl.innerText = "Total: Rp " + total.toLocaleString();
}

function resetCart() {
    cart = {};
    renderCart();
}

/* CHECKOUT */
function checkout() {
    if (Object.keys(cart).length === 0) return alert("Keranjang kosong");
    alert("Checkout siap (bisa sambung WA / stok)");
}

/* ADMIN */
function adminLogin() {
    const pin = prompt("PIN Admin:");
    if (pin === "kios123") alert("Admin mode OK (bisa dikembangkan)");
}
</script>

</body>
</html>
