<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kios 30</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root{
  --bg:#f9fafb;
  --card:#fff;
  --text:#111;
}
[data-theme="dark"]{
  --bg:#0f172a;
  --card:#1e293b;
  --text:#f8fafc;
}
body{
  margin:0;
  font-family:system-ui;
  background:var(--bg);
  color:var(--text);
}
header{
  text-align:center;
  padding:16px;
  font-size:22px;
  font-weight:700;
  user-select:none;
}
button,input,select{
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
}
.card{
  background:var(--card);
  padding:14px;
  margin:12px auto;
  max-width:480px;
  border-radius:14px;
}
.hidden{display:none}
.flex{display:flex;gap:8px}
.right-top{
  position:fixed;
  top:10px;
  right:10px;
}
</style>
</head>

<body>

<header id="title">ðŸ›’ Kios 30</header>

<div class="right-top">
  <button onclick="toggleTheme()">ðŸŒ™</button>
</div>

<!-- ADMIN ORANG TUA -->
<div class="card">
  <button onclick="openAdmin()">ðŸ”‘ Admin</button>
</div>

<!-- FORM BARANG -->
<div id="adminPanel" class="card hidden">
  <h3>Tambah / Edit Barang</h3>
  <input id="nama" placeholder="Nama barang">
  <input id="harga" type="number" placeholder="Harga">
  <input id="stok" type="number" placeholder="Stok">
  <select id="satuan">
    <option>kg</option>
    <option>pcs</option>
    <option>lusin</option>
    <option>dos</option>
    <option>satuan</option>
  </select>
  <button onclick="simpanBarang()">ðŸ’¾ Simpan</button>
</div>

<!-- DAFTAR BARANG -->
<div id="list"></div>

<!-- SUPER ADMIN -->
<div id="superAdmin" class="card hidden">
  <h3>ðŸ§  System Tools</h3>
  <button onclick="forceSync()">ðŸ”„ Force Sync</button>
  <button onclick="fixData()">ðŸ§¹ Fix Undefined</button>
  <button onclick="resetStok()">ðŸ“… Reset Stok</button>
</div>

<script>
/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "ISI_APIKEY",
  authDomain: "ISI_DOMAIN",
  projectId: "ISI_PROJECT_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ================= STATE ================= */
let isAdmin=false;
let isSuper=false;
let tapCount=0;

/* ================= RENDER ================= */
function renderBarang(data){
  const list=document.getElementById("list");
  list.innerHTML="";
  data.forEach(doc=>{
    const b=doc.data();
    if(!b.nama)return;
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`
      <b>${b.nama}</b><br>
      Rp ${b.harga ?? 0}<br>
      Stok: ${b.stok ?? 0} ${b.satuan ?? ""}
    `;
    list.appendChild(div);
  });
}

/* ================= LISTENER ================= */
db.collection("barang").onSnapshot(snap=>{
  renderBarang(snap.docs);
});

/* ================= ADMIN ================= */
function openAdmin(){
  const pw=prompt("Password Admin:");
  if(pw==="1234"){
    isAdmin=true;
    adminPanel.classList.remove("hidden");
  }
}

/* ================= SUPER ADMIN ================= */
let startX=null;
document.addEventListener("touchstart",e=>{
  startX=e.touches[0].clientX;
});
document.addEventListener("touchend",e=>{
  if(startX && e.changedTouches[0].clientX-startX>120){
    openSuper();
  }
  startX=null;
});
title.onclick=()=>{
  tapCount++;
  setTimeout(()=>tapCount=0,800);
  if(tapCount>=5)openSuper();
}
function openSuper(){
  const pw=prompt("System Passcode:");
  if(pw==="Edmund28"){
    isSuper=true;
    superAdmin.classList.remove("hidden");
    alert("Super Admin Aktif");
  }
}

/* ================= AKSI ================= */
function simpanBarang(){
  if(!isAdmin)return;
  db.collection("barang").add({
    nama:nama.value,
    harga:Number(harga.value),
    stok:Number(stok.value),
    satuan:satuan.value,
    updated:Date.now()
  });
}
function forceSync(){location.reload()}
function fixData(){
  db.collection("barang").get().then(snap=>{
    snap.forEach(d=>{
      const b=d.data();
      db.collection("barang").doc(d.id).update({
        nama:b.nama||"",
        harga:b.harga||0,
        stok:b.stok||0,
        satuan:b.satuan||"pcs"
      })
    })
  })
}
function resetStok(){
  if(confirm("Reset semua stok?")){
    db.collection("barang").get().then(snap=>{
      snap.forEach(d=>{
        db.collection("barang").doc(d.id).update({stok:0})
      })
    })
  }
}

/* ================= THEME ================= */
function toggleTheme(){
  document.body.dataset.theme=
    document.body.dataset.theme==="dark"?"":"dark";
}
</script>

</body>
</html>
