<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Kios Bersama Ultra v5</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<style>
:root{
--g:#00aa5b;--gd:#00894a;--gl:#e5f9f0;
--o:#ff5722;--bg:#f4f7fa;--c:#fff;
--t:#212b36;--ts:#637381;--b:#e5eaf2;
--r:16px;--tr:.25s cubic-bezier(.4,0,.2,1);
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter;background:var(--bg);color:var(--t)}
.hidden{display:none!important}
button{cursor:pointer;font-family:inherit}

header{
position:sticky;top:0;z-index:9;
display:flex;align-items:center;gap:12px;
padding:14px 20px;background:rgba(255,255,255,.9);
backdrop-filter:blur(10px);border-bottom:1px solid var(--b)
}

.logo{
background:var(--g);color:#fff;
padding:8px 12px;border-radius:10px;
font-weight:900
}

.search{flex:1;position:relative}
.search input{
width:100%;padding:12px 40px;border-radius:12px;
border:1px solid var(--b);outline:none
}

.badge{background:var(--gl);color:var(--gd);
padding:8px 12px;border-radius:10px;font-weight:700}

main{height:calc(100vh - 72px)}
.scroll{height:100%;overflow:auto;padding:20px}

.grid{
display:grid;gap:16px;
grid-template-columns:repeat(auto-fill,minmax(170px,1fr))
}

.card{
background:#fff;border-radius:16px;padding:12px;
border:1px solid var(--b);transition:var(--tr)
}
.card:hover{transform:translateY(-4px);border-color:var(--g)}

.img{
aspect-ratio:1;background:#f6f7f9;border-radius:12px;
display:flex;align-items:center;justify-content:center;
overflow:hidden;margin-bottom:8px
}
.img img{width:100%;height:100%;object-fit:cover}

.price{color:var(--g);font-weight:800}
.name{font-size:13px;font-weight:600;height:36px;overflow:hidden}

.drawer{
position:fixed;right:0;top:0;width:360px;height:100%;
background:#fff;box-shadow:-10px 0 30px rgba(0,0,0,.1);
padding:20px;transform:translateX(100%);transition:var(--tr);
z-index:20;display:flex;flex-direction:column
}
.drawer.active{transform:none}

.cart-item{display:flex;gap:10px;border-bottom:1px solid #eee;padding:10px 0}

.btn{
background:var(--g);color:#fff;border:none;
padding:14px;border-radius:12px;font-weight:800
}
.btn.alt{background:#eee;color:#333}

.admin{padding:30px;max-width:1100px;margin:auto}
.form{display:grid;gap:12px;grid-template-columns:2fr 1fr 1fr 1fr}

select,input{
padding:12px;border-radius:8px;border:1px solid var(--b)
}

.stat{
display:grid;grid-template-columns:repeat(3,1fr);
gap:12px;margin-bottom:20px
}
.stat div{
background:var(--gl);padding:16px;border-radius:14px;
text-align:center
}
</style>
</head>

<body>

<header>
<div class="logo">KB</div>
<div class="search">
<input id="q" placeholder="Cari produk..." />
</div>
<div class="badge" onclick="App.toggleCart()">üõí <span id="cc">0</span></div>
<button class="badge" id="adminBtn" onclick="App.askAdmin()">üîê Admin</button>
</header>

<main id="user">
<div class="scroll" onscroll="App.lazy()">
<div class="grid" id="grid"></div>
<p id="more" style="text-align:center;color:#999">Memuat‚Ä¶</p>
</div>
</main>

<section id="admin" class="admin hidden">
<div class="stat">
<div><h4>Total</h4><p id="stTotal">0</p></div>
<div><h4>Stok Menipis</h4><p id="stLow">0</p></div>
<div><h4>Aset</h4><p id="stVal">Rp 0</p></div>
</div>

<div class="form">
<input id="n" placeholder="Nama">
<input id="h" type="number" placeholder="Harga">
<input id="s" type="number" placeholder="Stok">
<select id="u">
<option>Kg</option><option>Ons</option><option>Gram</option>
<option>Liter</option><option>Mililiter</option>
<option>Botol</option><option>Sachet</option>
<option>Bungkus</option><option>Pack</option>
<option>Kardus</option><option>Renceng</option>
<option>Rak</option><option>Karung</option>
<option>Butir</option><option>Potong</option>
</select>
</div>
<input id="f" placeholder="URL Foto" style="width:100%;margin:10px 0">
<button class="btn" onclick="App.save()">Simpan / Update</button>
</section>

<div class="drawer" id="cart">
<h3>Keranjang</h3>
<div id="cl" style="flex:1;overflow:auto"></div>
<p><b>Total:</b> <span id="ct">Rp 0</span></p>
<button class="btn" onclick="App.checkout()">Checkout WA</button>
<button class="btn alt" onclick="App.resetCart()">üßπ Reset Keranjang</button>
</div>

<script>
const firebaseConfig={
apiKey:"AIzaSyBCpRbMAIyfJzpzi5iC4xljFt_gyXaJ5Yw",
authDomain:"kios-30.firebaseapp.com",
projectId:"kios-30"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

const App={
all:[],view:[],cart:JSON.parse(localStorage.getItem("cart")||"{}"),
limit:24,idx:0,admin:false,

init(){
db.collection("barang").onSnapshot(s=>{
this.all=s.docs.map(d=>({id:d.id,...d.data()}));
localStorage.setItem("cache",JSON.stringify(this.all));
this.apply();
});
document.getElementById("q").oninput=this.debounce(()=>this.apply(),300);
this.renderCart();
},

apply(){
const q=document.getElementById("q").value.toLowerCase();
this.view=this.all.filter(x=>x.nama.toLowerCase().includes(q));
this.idx=0;
document.getElementById("grid").innerHTML="";
this.lazy();
this.stat();
},

lazy(){
const g=document.getElementById("grid");
while(this.idx<this.view.length && g.children.length<this.idx+this.limit){
const p=this.view[this.idx++];
const d=document.createElement("div");
d.className="card";
d.innerHTML=`
<div class="img"><img src="${p.foto||'https://via.placeholder.com/200'}"></div>
<div class="price">Rp ${p.harga.toLocaleString()}</div>
<div class="name">${p.nama}</div>
<small>Stok ${p.stok} ${p.satuan}</small>`;
d.onclick=()=>this.add(p.id);
g.appendChild(d);
}
document.getElementById("more").style.display=
this.idx>=this.view.length?"none":"block";
},

add(id){
const p=this.all.find(x=>x.id===id);
if(!p||p.stok<=0)return alert("Stok habis");
this.cart[id]=(this.cart[id]||0)+1;
localStorage.setItem("cart",JSON.stringify(this.cart));
this.renderCart();
},

renderCart(){
const c=document.getElementById("cl");
let t=0,cnt=0;c.innerHTML="";
for(let id in this.cart){
const p=this.all.find(x=>x.id===id);if(!p)continue;
const sub=p.harga*this.cart[id];
t+=sub;cnt+=this.cart[id];
c.innerHTML+=`
<div class="cart-item">
<div style="flex:1">${p.nama}<br>${this.cart[id]} x ${p.harga}</div>
<b>Rp ${sub.toLocaleString()}</b>
</div>`;
}
document.getElementById("ct").innerText="Rp "+t.toLocaleString();
document.getElementById("cc").innerText=cnt;
},

resetCart(){
if(confirm("Kosongkan keranjang?")){
this.cart={};localStorage.removeItem("cart");
this.renderCart();
}
},

toggleCart(){
document.getElementById("cart").classList.toggle("active");
},

askAdmin(){
const pin=prompt("PIN Admin:");
if(pin!=="kios123")return alert("PIN salah");
this.admin=true;
document.getElementById("user").classList.add("hidden");
document.getElementById("admin").classList.remove("hidden");
},

save(){
const p={
nama:n.value,harga:+h.value,stok:+s.value,
satuan:u.value,foto:f.value
};
if(!p.nama||!p.harga)return alert("Data invalid");
const e=this.all.find(x=>x.nama.toLowerCase()==p.nama.toLowerCase());
e?db.collection("barang").doc(e.id).update(p)
:db.collection("barang").add(p);
},

checkout(){
let m="*PESANAN KIOS BERSAMA*\n";
for(let id in this.cart){
const p=this.all.find(x=>x.id===id);
m+=`‚Ä¢ ${p.nama} x${this.cart[id]} ${p.satuan}\n`;
}
window.open("https://wa.me/62811897005?text="+encodeURIComponent(m));
},

stat(){
let v=0,l=0;
this.all.forEach(p=>{
v+=p.harga*p.stok;
if(p.stok<5)l++;
});
stTotal.innerText=this.all.length;
stLow.innerText=l;
stVal.innerText="Rp "+v.toLocaleString();
},

debounce(fn,d){
let t;return()=>{clearTimeout(t);t=setTimeout(fn,d)};
}
};

App.init();
</script>

</body>
</html>
