<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kios Bersama - Smart Catalog</title>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<style>
:root{
  --bg:#f0f3f7; --card:#ffffff; --border:#e5e7eb;
  --text:#2e3137; --muted:#6d7588; --green:#00aa5b;
}
body{margin:0;font-family:system-ui, -apple-system, sans-serif;background:var(--bg);color:var(--text)}

header{
  background:var(--card); padding:12px 20px; display:flex; align-items:center; gap:20px;
  position:sticky; top:0; z-index:100; box-shadow:0 1px 6px rgba(0,0,0,0.1);
}
.logo{color:var(--green); font-weight:800; font-size:22px; cursor:pointer; white-space:nowrap}
.search-wrapper{flex:1; position:relative}
.search-wrapper input{
  width:100%; padding:10px 15px; border-radius:8px; border:1px solid var(--border);
  background:#f3f4f6; outline:none; box-sizing:border-box;
}

.container{max-width:1150px; margin:20px auto; padding:0 20px; display:flex; gap:20px; flex-wrap:wrap}

.tabs{display:flex; gap:10px; margin-bottom:16px}
.tabs button{
  padding:8px 16px; border-radius:20px; border:1px solid var(--border);
  background:var(--card); cursor:pointer; font-weight:600; color:var(--muted); width: auto;
}
.tabs button.active{background:#e8faf1; color:var(--green); border-color:var(--green)}

.main-content{flex:3; min-width:300px}
.card{background:var(--card); border:1px solid var(--border); border-radius:12px; padding:16px; margin-bottom:16px; box-shadow:0 1px 4px rgba(0,0,0,0.05)}

.grid-produk{display:grid; grid-template-columns:repeat(auto-fill, minmax(170px, 1fr)); gap:15px}
.item-produk{
  background:var(--card); border:1px solid var(--border); border-radius:10px; 
  overflow:hidden; transition:0.2s; display:flex; flex-direction:column; padding:12px;
  cursor: pointer;
}
.item-produk:hover{transform:translateY(-3px); box-shadow:0 4px 10px rgba(0,0,0,0.1)}
.img-box{width:100%; aspect-ratio:1/1; background:#f3f4f6; border-radius:8px; margin-bottom:10px; display:flex; align-items:center; justify-content:center; color:#ccc; font-size:30px}
.item-produk b{font-size:14px; height:38px; overflow:hidden; display:block; margin-bottom:4px}
.item-produk .price{color:var(--text); font-weight:800; font-size:16px}

/* MODAL DETAIL STYLE */
.modal{
  position: fixed; top:0; left:0; width:100%; height:100%; 
  background:rgba(0,0,0,0.6); display:none; justify-content:center; align-items:center; z-index:1000;
}
.modal-content{
  background:white; width:95%; max-width:850px; border-radius:20px; 
  display:flex; position:relative; max-height: 90vh; overflow:hidden;
}
.close-modal{position:absolute; right:20px; top:15px; font-size:30px; cursor:pointer; color:var(--muted); z-index:11}
.modal-left{flex:1; background:#f9fafb; display:flex; align-items:center; justify-content:center; padding:40px}
.modal-right{flex:1.2; padding:30px; overflow-y: auto; display:flex; flex-direction:column}

.stok-badge{background: #fff0e6; color: #ff6600; padding: 6px 12px; border-radius: 8px; font-size: 14px; font-weight: 700; width: fit-content; margin-bottom:15px}
.desc-section{border-top: 1px solid var(--border); margin-top: 20px; padding-top: 15px;}
.desc-title{font-weight: 800; color: var(--green); margin-bottom: 10px; display: block;}
.desc-text{font-size:14px; color:var(--text); line-height:1.6;}

.sidebar{flex:1; min-width:280px}
.cart-sticky{position:sticky; top:90px}

button{padding:12px; border:none; border-radius:10px; background:var(--green); color:white; cursor:pointer; font-weight:700; width:100%}
button.danger{background:#ef4444}
button.gray{background:#334155}
input,select,textarea{width:100%; padding:10px; border-radius:8px; border:1px solid var(--border); margin-bottom:10px; box-sizing:border-box}

.hidden{display:none}

@media (max-width: 750px) { .modal-content{flex-direction:column} .modal-left{padding:20px} }
</style>
</head>

<body>

<div id="productModal" class="modal" onclick="closeModal(event)">
  <div class="modal-content" onclick="event.stopPropagation()">
    <span class="close-modal" onclick="document.getElementById('productModal').style.display='none'">&times;</span>
    <div class="modal-left">
      <div id="modalImg" class="img-box" style="width:100%; height: 300px; font-size: 100px;">üì¶</div>
    </div>
    <div class="modal-right">
      <h1 id="modalTitle" style="margin:0; font-size: 26px;">Nama Produk</h1>
      <div id="modalPrice" style="font-size: 34px; font-weight:800; color:var(--green); margin:10px 0">Rp 0</div>
      <div id="modalStok" class="stok-badge">Sisa 0</div>
      
      <div class="desc-section">
        <span class="desc-title">Detail Produk</span>
        <div class="desc-text" id="modalDesc"></div>
      </div>
      
      <div id="generalNoteBox" style="margin-top:20px; padding:15px; background:#f8fafc; border:1px solid #cbd5e1; border-radius:12px; display:none">
        <b style="color:#475569; font-size:13px">üìù Catatan Tambahan:</b>
        <div id="generalNoteText" style="font-size:14px; margin-top:5px; color:#334155"></div>
      </div>
      
      <div style="margin-top: 30px;">
        <button id="modalAddBtn">+ Tambah ke Keranjang</button>
      </div>
    </div>
  </div>
</div>

<header>
  <div class="logo" onclick="location.reload()">üß∫ Kios Bersama</div>
  <div class="search-wrapper">
    <input type="text" id="searchInput" placeholder="Cari barang..." onkeyup="filterBarang()">
  </div>
</header>

<div class="container">
  <div class="main-content">
    <div class="tabs">
      <button id="tabBuyer" class="active">üõí Belanja</button>
      <button id="tabAdmin">üîê Admin</button>
    </div>

    <div id="buyer">
      <div class="grid-produk" id="buyerList"></div>
    </div>

    <div id="admin" class="hidden">
      <div class="card">
        <h3>Input Inventaris</h3>
        <input id="nama" placeholder="Nama Barang">
        <input id="harga" type="number" placeholder="Harga">
        <input id="stok" type="number" placeholder="Stok">
        <select id="satuan">
          <option value="">Satuan</option>
          <option>Bungkus</option><option>Botol</option><option>Sachet</option><option>Kg</option>
          <option>Liter</option><option>Pcs</option><option>Kardus</option>
        </select>
        <textarea id="notes" placeholder="Catatan tambahan untuk pembeli (Optional)..."></textarea>
        <button onclick="simpan()">Simpan Barang</button>
      </div>

      <div class="card">
        <h3>Daftar Barang</h3>
        <div id="adminList"></div>
      </div>
    </div>
  </div>

  <div class="sidebar">
    <div class="card cart-sticky">
      <h3>üõí Pesanan</h3>
      <div id="cart" style="font-size:14px">Kosong.</div>
      <div style="margin-top:15px; border-top:1px solid #eee; padding-top:10px">
        <b>Total: Rp <span id="total">0</span></b>
      </div>
      <button onclick="checkout()">Order via WA</button>
    </div>
  </div>
</div>

<script>
const ADMIN_PW = "kios123";
let adminUnlocked = false;

firebase.initializeApp({
  apiKey: "AIzaSyBCpRbMAIyfJzpzi5iC4xljFt_gyXaJ5Yw",
  authDomain: "kios-30.firebaseapp.com",
  projectId: "kios-30"
});
const db = firebase.firestore();

let BARANG = [];
let CART = {};
const WA = "62811897005";

db.collection("barang").onSnapshot(snap=>{
  BARANG=[];
  snap.forEach(doc=>{ BARANG.push({id:doc.id, ...doc.data()}); });
  renderBuyer();
  renderAdmin();
});

function getSmartDescription(b) {
  const n = b.nama.toLowerCase();
  if(n.includes("mie") || n.includes("indomie")) return `Mie instan lezat, praktis, dan jadi favorit semua orang. Cocok untuk stok darurat di rumah!`;
  if(n.includes("bir") || n.includes("bintang")) return `Minuman penyegar suasana. Nikmati kesegarannya dalam kondisi dingin bersama teman.`;
  if(n.includes("beras")) return `Beras putih pilihan, pulen dan harum. Pilihan tepat untuk nasi berkualitas bagi keluarga.`;
  if(n.includes("rokok")) return `Produk tembakau pilihan, stok selalu baru dan terjaga kualitasnya.`;
  return `Produk <b>${b.nama}</b> dengan kualitas terjamin. Tersedia di Kios Bersama untuk memenuhi kebutuhan harian Anda.`;
}

function openDetail(id){
  const b = BARANG.find(x => x.id === id);
  document.getElementById("modalTitle").innerText = b.nama;
  document.getElementById("modalPrice").innerText = "Rp " + b.harga.toLocaleString();
  document.getElementById("modalStok").innerText = `Sisa Stok: ${b.stok} ${b.satuan}`;
  document.getElementById("modalDesc").innerHTML = getSmartDescription(b);
  
  const noteBox = document.getElementById("generalNoteBox");
  if(b.notes && b.notes.trim() !== "") {
    noteBox.style.display = "block";
    document.getElementById("generalNoteText").innerText = b.notes;
  } else {
    noteBox.style.display = "none";
  }
  
  document.getElementById("modalAddBtn").onclick = () => { addCart(id); document.getElementById('productModal').style.display='none'; };
  document.getElementById("productModal").style.display = "flex";
}

function simpan(){
  const n = document.getElementById("nama"), h = document.getElementById("harga"), 
        s = document.getElementById("stok"), sat = document.getElementById("satuan"),
        nt = document.getElementById("notes");
        
  if(!n.value||!h.value||!s.value||!sat.value) return alert("Isi data dengan lengkap!");
  
  db.collection("barang").add({
    nama: n.value, harga: +h.value, stok: +s.value, satuan: sat.value, notes: nt.value
  });
  
  n.value=h.value=s.value=nt.value="";
}

function renderBuyer(f = ""){
  const l = document.getElementById("buyerList"); l.innerHTML="";
  BARANG.filter(b=>b.nama.toLowerCase().includes(f.toLowerCase())).forEach(b=>{
    l.innerHTML+=`<div class="item-produk" onclick="openDetail('${b.id}')">
        <div class="img-box">üì¶</div>
        <b>${b.nama}</b>
        <div class="price">Rp ${b.harga.toLocaleString()}</div>
        <div style="font-size:11px; color:var(--muted); margin-top:5px">Stok: ${b.stok}</div>
      </div>`;
  });
}

function renderAdmin(){
  const l = document.getElementById("adminList"); l.innerHTML="";
  BARANG.forEach(b=>{
    l.innerHTML+=`<div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding:8px 0">
      <div><b>${b.nama}</b><br><small>Rp ${b.harga} | Sisa ${b.stok}</small></div>
      <button class="danger" style="width:auto; padding:4px 10px" onclick="db.collection('barang').doc('${b.id}').delete()">Hapus</button>
    </div>`;
  });
}

function addCart(id){
  const b = BARANG.find(x => x.id === id);
  if((CART[id]||0)+1 > b.stok) return alert("Stok tidak cukup!");
  CART[id]=(CART[id]||0)+1; renderCart();
}

function renderCart(){
  const c = document.getElementById("cart"); c.innerHTML=""; let t=0;
  for(let id in CART){
    const b = BARANG.find(x=>x.id===id);
    if(!b) continue;
    t += b.harga * CART[id];
    c.innerHTML += `<div>${b.nama} x${CART[id]}</div>`;
  }
  document.getElementById("total").innerText = t.toLocaleString();
}

function checkout(){
  if(Object.keys(CART).length === 0) return alert("Keranjang kosong!");
  let m = "*ORDER KIOS BERSAMA*%0A%0A";
  for(let id in CART){
    const b = BARANG.find(x=>x.id===id);
    m += `- ${b.nama} (x${CART[id]})%0A`;
  }
  m += `%0A*Total: Rp ${document.getElementById("total").innerText}*`;
  window.open(`https://wa.me/${WA}?text=${m}`);
}

function filterBarang(){ renderBuyer(document.getElementById("searchInput").value); }
function closeModal(e){ if(e.target.id === "productModal") e.target.style.display="none"; }

tabBuyer.onclick=()=>{
  document.getElementById("buyer").classList.remove("hidden"); document.getElementById("admin").classList.add("hidden");
  tabBuyer.classList.add("active"); tabAdmin.classList.remove("active");
};
tabAdmin.onclick=()=>{
  if(!adminUnlocked){
    if(prompt("Password Admin:") !== ADMIN_PW) return alert("Salah!");
    adminUnlocked=true;
  }
  document.getElementById("admin").classList.remove("hidden"); document.getElementById("buyer").classList.add("hidden");
  tabAdmin.classList.add("active"); tabBuyer.classList.remove("active");
};
</script>
</body>
</html>
