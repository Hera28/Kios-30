<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Kios Bersama</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBCpRbMAIyfJzpzi5iC4xljFt_gyXaJ5Yw",
      authDomain: "kios-30.firebaseapp.com",
      projectId: "kios-30",
      storageBucket: "kios-30.appspot.com",
      messagingSenderId: "253251437301",
      appId: "1:253251437301:web:310e2495d742aa2dd63bbc"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.db = db;
    window.collection = collection;
    window.addDoc = addDoc;
    window.onSnapshot = onSnapshot;
    window.doc = doc;
    window.updateDoc = updateDoc;
  </script>

  <style>
    :root {
      --green: #1abc5c;
      --dark: #0f172a;
      --card: #1e293b;
      --text: #e5e7eb;
    }

    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: linear-gradient(180deg, #0f172a, #020617);
      color: var(--text);
    }

    header {
      background: var(--green);
      color: #fff;
      padding: 14px 20px;
      font-size: 20px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .container {
      max-width: 1100px;
      margin: auto;
      padding: 20px;
    }

    .hidden { display: none; }

    .card {
      background: var(--card);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.3);
    }

    button {
      background: var(--green);
      border: none;
      padding: 10px 14px;
      border-radius: 10px;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }

    button.secondary {
      background: #475569;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      margin-bottom: 10px;
      border-radius: 10px;
      border: none;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill,minmax(220px,1fr));
      gap: 12px;
    }

    .item {
      background: #020617;
      padding: 12px;
      border-radius: 12px;
    }

    .item h4 { margin: 0 0 6px; }

    .nav-btn {
      width: 100%;
      padding: 14px;
      margin-bottom: 10px;
      font-size: 16px;
    }
  </style>
</head>

<body>

<header>
  üß∫ Kios Bersama
  <button onclick="toggleMode()">üåô</button>
</header>

<div class="container">

  <!-- WELCOME -->
  <div id="welcome">
    <div class="card">
      <button class="nav-btn" onclick="goBuyer()">üõí Pembeli</button>
      <button class="nav-btn secondary" onclick="goAdmin()">üîê Admin</button>
    </div>
  </div>

  <!-- BUYER -->
  <div id="buyer" class="hidden">
    <div class="card">
      <h3>Pilih Barang</h3>
      <div id="buyerList" class="grid"></div>
    </div>

    <div class="card">
      <h3>Keranjang</h3>
      <div id="cart"></div>
      <h4 id="total">Total: Rp 0</h4>
      <button onclick="checkout()">üì≤ Pesan via WhatsApp</button>
      <button class="secondary" onclick="goWelcome()">‚¨Ö Kembali</button>
    </div>
  </div>

  <!-- ADMIN -->
  <div id="admin" class="hidden">
    <div class="card">
      <h3>Kelola Barang</h3>
      <input id="nama" placeholder="Nama barang">
      <input id="harga" type="number" placeholder="Harga">
      <input id="stok" type="number" placeholder="Stok">
      <select id="satuan">
        <option value="">Satuan</option>
        <option>pcs</option>
        <option>kg</option>
        <option>dus</option>
        <option>lusin</option>
      </select>
      <button onclick="simpan()">üíæ Simpan</button>
    </div>

    <div class="card">
      <h3>Daftar Barang</h3>
      <div id="adminList" class="grid"></div>
      <button class="secondary" onclick="goWelcome()">‚¨Ö Keluar</button>
    </div>
  </div>

</div>

<script>
  let cart = [];
  let total = 0;
  let dark = true;

  function goBuyer() {
    hideAll();
    document.getElementById("buyer").classList.remove("hidden");
  }

  function goAdmin() {
    hideAll();
    document.getElementById("admin").classList.remove("hidden");
  }

  function goWelcome() {
    hideAll();
    document.getElementById("welcome").classList.remove("hidden");
  }

  function hideAll() {
    ["welcome","buyer","admin"].forEach(id =>
      document.getElementById(id).classList.add("hidden")
    );
  }

  function toggleMode() {
    dark = !dark;
    document.body.style.background = dark
      ? "linear-gradient(180deg,#0f172a,#020617)"
      : "#f8fafc";
    document.body.style.color = dark ? "#e5e7eb" : "#020617";
  }

  async function simpan() {
    const data = {
      nama: nama.value,
      harga: +harga.value,
      stok: +stok.value,
      satuan: satuan.value
    };
    if (!data.nama) return alert("Lengkapi data");

    await addDoc(collection(db,"barang"), data);
    nama.value = harga.value = stok.value = "";
  }

  onSnapshot(collection(db,"barang"), snap => {
    buyerList.innerHTML = "";
    adminList.innerHTML = "";

    snap.forEach(d => {
      const b = d.data();
      if (!b.nama) return;

      buyerList.innerHTML += `
        <div class="item">
          <h4>${b.nama}</h4>
          <p>Rp ${b.harga} / ${b.satuan}</p>
          <p>Stok ${b.stok}</p>
          <button onclick='addCart("${b.nama}",${b.harga})'>Tambah</button>
        </div>`;

      adminList.innerHTML += `
        <div class="item">
          <b>${b.nama}</b>
          <p>Stok: ${b.stok}</p>
        </div>`;
    });
  });

  function addCart(nama,harga){
    cart.push({nama,harga});
    total += harga;
    renderCart();
  }

  function renderCart(){
    cartDiv = document.getElementById("cart");
    cartDiv.innerHTML = cart.map(c=>`‚Ä¢ ${c.nama} - Rp ${c.harga}`).join("<br>");
    document.getElementById("total").innerText = "Total: Rp " + total;
  }

  function checkout(){
    let text = "Halo, saya mau pesan:%0A";
    cart.forEach(c=> text += `‚Ä¢ ${c.nama} Rp ${c.harga}%0A`);
    text += `%0ATotal: Rp ${total}`;
    window.open("https://wa.me/62XXXXXXXXXX?text="+text);
  }
</script>

</body>
</html>
