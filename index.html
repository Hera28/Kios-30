<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kios 30 – Firebase FIX</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:#f4f6f8;
}
header{
  background:#fff;
  padding:12px 16px;
  display:flex;
  gap:12px;
  align-items:center;
  border-bottom:1px solid #e5e7eb;
}
.logo{
  width:42px;height:42px;
  border-radius:12px;
  background:#16a34a;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:800;
}
input,select,button{
  padding:8px 10px;
  border-radius:8px;
  border:1px solid #d1d5db;
}
button{
  cursor:pointer;
  background:#16a34a;
  color:#fff;
  border:none;
}
main{
  display:grid;
  grid-template-columns:1fr 360px;
  gap:16px;
  padding:16px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
  gap:12px;
}
.card{
  background:#fff;
  border-radius:12px;
  padding:12px;
  box-shadow:0 6px 14px rgba(0,0,0,.06);
}
.cart{
  background:#fff;
  border-radius:12px;
  padding:12px;
}
.error{
  background:#fee2e2;
  color:#991b1b;
  padding:12px;
  border-radius:10px;
  margin:16px;
  font-weight:600;
}
.hidden{display:none}
</style>
</head>

<body>

<header>
  <div class="logo">KB</div>
  <input id="search" placeholder="Cari produk..." style="flex:1">
  <button onclick="toggleAdmin()">Admin</button>
</header>

<div id="errorBox" class="error hidden"></div>

<main>
  <div>
    <h3>Produk</h3>
    <div id="produk" class="grid"></div>
  </div>

  <div class="cart">
    <h3>Keranjang</h3>
    <div id="cart"></div>
    <hr>
    <b>Total: Rp <span id="total">0</span></b>
    <br><br>
    <button onclick="checkout()">Checkout</button>
    <button style="background:#ef4444" onclick="resetCart()">Reset</button>
  </div>
</main>

<div id="admin" class="hidden" style="padding:16px">
  <h3>Admin – Tambah Produk</h3>
  <input id="aNama" placeholder="Nama">
  <input id="aHarga" placeholder="Harga" type="number">
  <select id="aSatuan">
    <option>Kilogram</option>
    <option>Ons</option>
    <option>Gram</option>
    <option>Liter</option>
    <option>Mililiter</option>
    <option>Botol</option>
    <option>Sachet</option>
    <option>Bungkus</option>
    <option>Pack</option>
    <option>Kardus</option>
    <option>Renceng</option>
    <option>Rak</option>
    <option>Karung</option>
    <option>Butir</option>
    <option>Potong</option>
  </select>
  <button onclick="tambahProduk()">Simpan</button>
</div>

<!-- FIREBASE CDN -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ================= FIREBASE INIT ================= */
firebase.initializeApp({
  apiKey: "AIzaSyBCpRbMAIyfJzpzi5iC4xljFt_gyXaJ5Yw",
  authDomain: "kios-30.firebaseapp.com",
  projectId: "kios-30",
  storageBucket: "kios-30.firebasestorage.app",
  messagingSenderId: "253251437301",
  appId: "1:253251437301:web:310e2495d742aa2dd63bbc"
});

const db = firebase.firestore();
const produkDiv = document.getElementById("produk");
const errorBox = document.getElementById("errorBox");

/* ================= CART ================= */
let cart = [];

function addCart(nama,harga){
  cart.push({nama,harga});
  renderCart();
}
function renderCart(){
  const c=document.getElementById("cart");
  c.innerHTML="";
  let total=0;
  cart.forEach(i=>{
    total+=i.harga;
    c.innerHTML+=`<div>${i.nama} - Rp ${i.harga}</div>`;
  });
  document.getElementById("total").innerText=total;
}
function resetCart(){
  cart=[];
  renderCart();
}
function checkout(){
  alert("Total Rp "+document.getElementById("total").innerText);
  resetCart();
}

/* ================= ADMIN ================= */
function toggleAdmin(){
  document.getElementById("admin").classList.toggle("hidden");
}
function tambahProduk(){
  db.collection("produk").add({
    nama:aNama.value,
    harga:Number(aHarga.value),
    satuan:aSatuan.value
  }).then(loadProduk);
}

/* ================= CORE: LOAD + SEED ================= */
async function seedIfEmpty(){
  const snap = await db.collection("produk").get();
  if(snap.empty){
    const seed = [
      {nama:"Beras Ramos",harga:13000,satuan:"Kilogram"},
      {nama:"Gula Pasir",harga:14000,satuan:"Kilogram"},
      {nama:"Minyak Goreng",harga:17000,satuan:"Liter"},
      {nama:"Telur Ayam",harga:28000,satuan:"Kilogram"},
      {nama:"Mi Instan",harga:3500,satuan:"Pack"},
      {nama:"Kopi Sachet",harga:2000,satuan:"Sachet"},
      {nama:"Air Mineral",harga:4000,satuan:"Botol"}
    ];
    for(const p of seed){
      await db.collection("produk").add(p);
    }
  }
}

async function loadProduk(){
  try{
    produkDiv.innerHTML="";
    const snap = await db.collection("produk").get();
    snap.forEach(doc=>{
      const p = doc.data();
      const el = document.createElement("div");
      el.className="card";
      el.innerHTML = `
        <b>${p.nama}</b>
        <div>${p.satuan}</div>
        <div>Rp ${p.harga}</div>
        <button onclick="addCart('${p.nama}',${p.harga})">Tambah</button>
      `;
      produkDiv.appendChild(el);
    });
  }catch(e){
    errorBox.classList.remove("hidden");
    errorBox.innerText = "FIRESTORE ERROR: " + e.message;
  }
}

/* ================= INIT ================= */
(async()=>{
  try{
    await seedIfEmpty();
    await loadProduk();
  }catch(e){
    errorBox.classList.remove("hidden");
    errorBox.innerText = "INIT ERROR: " + e.message;
  }
})();
</script>

</body>
</html>
