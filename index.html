<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kios Bersama</title>

<!-- Firebase compat -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<style>
:root{
  --bg:#0f172a;
  --card:#111827;
  --border:#1f2937;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --green:#22c55e;
}
body.light{
  --bg:#f8fafc;
  --card:#ffffff;
  --border:#e5e7eb;
  --text:#1f2937;
  --muted:#64748b;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Segoe UI,Roboto;
  background:var(--bg);
  color:var(--text);
}
header{
  background:linear-gradient(90deg,#22c55e,#16a34a);
  padding:18px;
  border-radius:0 0 18px 18px;
  text-align:center;
  font-weight:700;
  font-size:20px;
  position:relative;
}
#theme{
  position:absolute;
  right:18px;
  top:18px;
  cursor:pointer;
}
.container{
  max-width:1100px;
  margin:auto;
  padding:24px;
}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:20px;
  margin-bottom:20px;
}
button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  background:var(--green);
  color:#022c22;
  font-weight:600;
  cursor:pointer;
}
button.danger{background:#ef4444;color:white}
input,select,textarea{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#020617;
  color:var(--text);
}
.flex{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
}
.item{
  border-bottom:1px solid var(--border);
  padding:12px 0;
}
.hidden{display:none}
.tabs{
  display:flex;
  background:var(--card);
  border-radius:14px;
  overflow:hidden;
  margin-bottom:20px;
}
.tabs button{
  flex:1;
  background:none;
  color:var(--text);
}
.tabs button.active{
  background:var(--green);
  color:#022c22;
}
.small{font-size:13px;color:var(--muted)}
</style>
</head>

<body>
<header>
  üß∫ Kios Bersama
  <div id="theme">üåô</div>
</header>

<div class="container">

<div class="tabs">
  <button id="tabBuyer" class="active">üõí Pembeli</button>
  <button id="tabAdmin">üîê Admin</button>
</div>

<!-- BUYER -->
<div id="buyer">
  <div class="card">
    <h3>Daftar Barang</h3>
    <div id="buyerList"></div>
  </div>

  <div class="card">
    <h3>Keranjang</h3>
    <div id="cart"></div>
    <div class="flex" style="margin-top:12px">
      <b>Total: Rp <span id="total">0</span></b>
      <button onclick="checkout()">Checkout WA</button>
    </div>
  </div>
</div>

<!-- ADMIN -->
<div id="admin" class="hidden">

  <!-- ASISTEN STOK -->
  <div class="card">
    <h3>ü§ñ Asisten Stok</h3>
    <textarea id="aiInput" placeholder="Contoh: stok beras"></textarea>
    <button style="margin-top:10px" onclick="tanyaAsisten()">Tanya</button>
    <div id="aiOutput" class="small" style="margin-top:10px"></div>
  </div>

  <!-- TAMBAH BARANG -->
  <div class="card">
    <h3>Tambah Barang</h3>
    <input id="nama" placeholder="Nama barang">
    <input id="harga" type="number" placeholder="Harga">
    <input id="stok" type="number" placeholder="Stok">
    <select id="satuan">
      <option value="">Satuan</option>
      <option>pcs</option>
      <option>kg</option>
      <option>liter</option>
      <option>dus</option>
    </select>
    <button style="margin-top:10px" onclick="simpan()">Simpan</button>
  </div>

  <!-- DAFTAR -->
  <div class="card">
    <h3>Daftar Barang</h3>
    <div id="adminList"></div>
  </div>

</div>
</div>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyBCpRbMAIyfJzpzi5iC4xljFt_gyXaJ5Yw",
  authDomain: "kios-30.firebaseapp.com",
  projectId: "kios-30"
});
const db = firebase.firestore();

/* CONFIG */
const ADMIN_PASS = "11229911";
const WA = "62811897005";

/* STATE */
let BARANG = [];
let CART = {};

/* THEME */
theme.onclick = () => document.body.classList.toggle("light");

/* TAB */
tabBuyer.onclick = () => switchTab("buyer");
tabAdmin.onclick = () => {
  const pw = prompt("Password admin:");
  if (pw === ADMIN_PASS) switchTab("admin");
};
function switchTab(t){
  buyer.classList.toggle("hidden", t !== "buyer");
  admin.classList.toggle("hidden", t !== "admin");
  tabBuyer.classList.toggle("active", t === "buyer");
  tabAdmin.classList.toggle("active", t === "admin");
}

/* FIRESTORE LISTENER */
db.collection("barang").onSnapshot(snap=>{
  BARANG = [];
  snap.forEach(doc=>{
    BARANG.push({id:doc.id, ...doc.data()});
  });
  renderBuyer();
  renderAdmin();
});

/* CRUD */
function simpan(){
  if(!nama.value||!harga.value||!stok.value||!satuan.value)
    return alert("Lengkapi data");
  db.collection("barang").add({
    nama:nama.value,
    harga:+harga.value,
    stok:+stok.value,
    satuan:satuan.value
  });
  nama.value=harga.value=stok.value="";
}

/* RENDER */
function renderBuyer(){
  buyerList.innerHTML="";
  BARANG.forEach(b=>{
    buyerList.innerHTML+=`
    <div class="item flex">
      <div>
        <b>${b.nama}</b>
        <div class="small">Rp ${b.harga} / ${b.satuan} ‚Ä¢ Stok ${b.stok}</div>
      </div>
      <button onclick="addCart('${b.id}')">Tambah</button>
    </div>`;
  });
}
function renderAdmin(){
  adminList.innerHTML="";
  BARANG.forEach(b=>{
    adminList.innerHTML+=`
    <div class="item flex">
      <b>${b.nama}</b>
      <button class="danger" onclick="hapus('${b.id}')">Hapus</button>
    </div>`;
  });
}
function hapus(id){
  if(confirm("Hapus barang?"))
    db.collection("barang").doc(id).delete();
}

/* CART */
function addCart(id){
  CART[id]=(CART[id]||0)+1;
  renderCart();
}
function renderCart(){
  cart.innerHTML="";
  let total=0;
  for(let id in CART){
    const b=BARANG.find(x=>x.id===id);
    if(!b) continue;
    total+=b.harga*CART[id];
    cart.innerHTML+=`${b.nama} x ${CART[id]}<br>`;
  }
  totalEl.innerText=total.toLocaleString();
}
const totalEl=document.getElementById("total");

/* CHECKOUT */
function checkout(){
  let msg="Halo, saya mau pesan:%0A";
  let total=0;
  for(let id in CART){
    const b=BARANG.find(x=>x.id===id);
    msg+=`‚Ä¢ ${b.nama} x ${CART[id]}%0A`;
    total+=b.harga*CART[id];
  }
  msg+=`Total: Rp ${total}`;
  window.open(`https://wa.me/${WA}?text=${msg}`);
}

/* ASISTEN STOK */
function tanyaAsisten(){
  const q = aiInput.value.toLowerCase();
  const out = document.getElementById("aiOutput");

  const found = BARANG.find(b =>
    q.includes(b.nama.toLowerCase())
  );

  out.innerText = found
    ? `ü§ñ Stok ${found.nama}: ${found.stok} ${found.satuan}`
    : "ü§ñ Barang tidak ditemukan";
}
</script>
</body>
</html>
